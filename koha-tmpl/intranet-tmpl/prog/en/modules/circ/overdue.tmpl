<!-- TMPL_INCLUDE NAME="doc-head-open.inc" -->
<title>Koha &rsaquo; Circulation &rsaquo; Items Overdue as of <!-- TMPL_VAR NAME="todaysdate" --></title>
<!-- TMPL_INCLUDE NAME="doc-head-close.inc" -->
<script type="text/JavaScript" language="JavaScript">
//<![CDATA[
    function clone_parent(node) {
        var parent = node.parentNode;
		var clone = parent.cloneNode(true);
        $("a", clone).attr("style", "visibility: visible");
        $("input", clone).attr("value", "");

		var theid = $("span", clone).attr("id") || "";
		var parts = theid.match(/^pattrodue-getready-(.*)$/);
		if (parts && parts.length > 1)
		{
			var appendid = "-" + Math.floor(Math.random()*1000+1);
			$("span", clone).attr("id",theid+appendid);

			theid = $("input", clone).attr("id");
			$("input", clone).attr("id",theid+appendid);

			theid = $("div[id]", clone).attr("id");
			$("div[id]", clone).attr("id",theid+appendid);

			var attrcode = $("script", clone).attr("x-code");
			var newsuffix = parts[1] + appendid;
			create_auto_completion_responder(newsuffix,attrcode);
		}

        parent.parentNode.insertBefore(clone, parent.nextSibling);
    }
    function delete_parent(node) {
        var parent = node.parentNode;
        parent.parentNode.removeChild(parent);
    }
	function create_auto_completion_responder(uniqueid,attrcode) {
		YAHOO.util.Event.onContentReady("pattrodue-getready-"+uniqueid, function() {
			new function() {
				// Define a custom formatter function
				this.fnCustomFormatter = function(oResultItem, sQuery) {
					var description = oResultItem[0];
					var authorised_value = oResultItem[1];
					var aMarkup = [
						"<div class='pattrodue-result'>",
						description,
						" (",
						authorised_value,
						")",
						"</div>"];
					return (aMarkup.join(""));
				};

				// Instantiate an XHR DataSource
				this.oACDS = new YAHOO.widget.DS_XHR("/cgi-bin/koha/circ/ypattrodue-attr-search-authvalue.pl/"+attrcode, ["\n", "\t"]);
				this.oACDS.responseType = YAHOO.widget.DS_XHR.TYPE_FLAT;
				this.oACDS.maxCacheEntries = 60;
				this.oACDS.queryMatchSubset = true;

				// Instantiate an AutoComplete Widget with uniqueid
				var myInput = document.getElementById('pattrodue-input-'+uniqueid);
				var myContainer = document.getElementById('pattrodue-container-'+uniqueid);
				this.oAutoComp = new YAHOO.widget.AutoComplete(myInput,myContainer,this.oACDS);
				this.oAutoComp.formatResult = this.fnCustomFormatter;
			}
		});
	}

//]]>
</script>
<style type="text/css">
    .sql {display:none;}
</style>
</head>
<body>
<!-- TMPL_INCLUDE NAME="header.inc" -->
<!-- TMPL_INCLUDE NAME="circ-search.inc" -->

<div id="breadcrumbs"><a href="/cgi-bin/koha/mainpage.pl">Home</a> &rsaquo; <a href="/cgi-bin/koha/circ/circulation-home.pl">Circulation</a> &rsaquo; Overdues as of <!-- TMPL_VAR NAME="todaysdate" --></div>

<div id="doc3" class="yui-t2">

   <div id="bd">
	<div id="yui-main">
	<div class="yui-b">

<!-- TMPL_IF name="noreport" -->

<h2>Overdue Report</h2>

<p>Please choose one or more filters to proceed.</p>

<!-- TMPL_ELSE -->

<h2><!-- TMPL_VAR NAME="nnoverdue" --> Item<!-- TMPL_IF NAME="noverdue_is_plural" -->s<!-- /TMPL_IF -->
	 Overdue as of <!-- TMPL_VAR NAME="todaysdate" --><!-- TMPL_IF NAME="isfiltered" --> (filtered)<!-- /TMPL_IF --></h2>

<!-- TMPL_INCLUDE NAME="jasper.inc" -->

<p>
    <!-- TMPL_IF NAME="isfiltered" -->
      <a href="overdue.pl?op=csv&amp;<!-- TMPL_VAR name="csv_param_string" escape="HTML" -->">Download file of displayed overdues</a>
    <!-- TMPL_ELSE -->
      <a href="overdue.pl?op=csv">Download file of all overdues</a>
    <!-- /TMPL_IF -->
    
    <a style="color: white;" href="overdue.pl?op=send_email&amp;<!-- TMPL_VAR name="csv_param_string" escape="HTML" -->">
    	<input type="button" value="Send email" />
    </a>
    
    <a style="color: white;" href="overdue.pl?op=print_noemail&amp;<!-- TMPL_VAR name="csv_param_string" escape="HTML" -->">
    	<input type="button" value="Print notices from borrowers without email" />
    </a>
</p>
<div class="sql"><pre><!-- TMPL_VAR NAME="sql" ESCAPE="HTML" --></pre></div>
<div class="searchresults">
<table id="overduest">
<thead><tr>
    <th>Due Date</th>
    <th>Patron</th>
    <th>Library</th>
    <th>Title</th>
    <th>Barcode</th>
    <th>Call number</th>
    <th>Notify</th>
</tr></thead>

<tbody><!-- TMPL_LOOP NAME="overdueloop" -->
    <tr>
        <td><!-- TMPL_VAR NAME="duedate" --></td>
        <td><a href="/cgi-bin/koha/members/moremember.pl?borrowernumber=<!-- TMPL_VAR name="borrowernumber"-->"><!-- TMPL_VAR NAME="name" --></a>
        <!-- TMPL_IF NAME="email" -->[<a href="mailto:<!-- TMPL_VAR NAME="email" -->?subject=Overdue: <!-- TMPL_VAR NAME="title" ESCAPE="html" -->">email</a>]<!-- /TMPL_IF -->
        (<!--TMPL_IF NAME="phone" --><!-- TMPL_VAR NAME="phone" --><!-- TMPL_ELSIF NAME="mobile" --><!-- TMPL_VAR NAME="mobile" --><!-- TMPL_ELSIF NAME="phonepro" --><!-- TMPL_VAR NAME="phonepro" --><!-- /TMPL_IF -->)</td>
        <td><!-- TMPL_VAR name="branchcode" --></td>
        <td><!-- TMPL_INCLUDE NAME="biblio-default-view.inc" --><!-- TMPL_VAR NAME="title" ESCAPE="html" -->  <!-- TMPL_VAR NAME="subtitle" --></a> <!-- TMPL_IF NAME="author" -->, by <!-- TMPL_VAR NAME="author" --><!-- /TMPL_IF -->
        </td>
		<td><a href="/cgi-bin/koha/catalogue/moredetail.pl?biblionumber=<!-- TMPL_VAR NAME="biblionumber" -->&amp;itemnumber=<!-- TMPL_VAR NAME="itemnum" -->#item<!-- TMPL_VAR NAME="itemnum" -->"><!-- TMPL_VAR name="barcode" --></a></td>
		<td><!-- TMPL_VAR name="itemcallnumber" --></td>
		<td><!-- TMPL_IF NAME="notify_method" -->
		          by 
		          <!-- TMPL_IF NAME="notify_method_letter" -->letter<!-- /TMPL_IF -->
		          <!-- TMPL_IF NAME="notify_method_mail" -->mail<!-- /TMPL_IF -->
		          <!-- TMPL_IF NAME="notify_method_sms" -->sms</TMPL_IF> 
		          on <!-- TMPL_VAR NAME="notify_date" --><!-- TMPL_ELSE -->&nbsp;
		    <!-- /TMPL_IF -->
		</td>
        </tr>
<!-- /TMPL_LOOP --></tbody>
</table>

</div>
<!-- /TMPL_IF -->  <!-- noreport -->

</div>
</div>
<div class="yui-b">
	<form method="post" action="/cgi-bin/koha/circ/overdue.pl">
		<fieldset class="brief">
			<h4>Filter On:</h4>
			<ol>
				<li>
					<label>Overdue category:</label>
					<select name="overduetype" id="overduetype">
						<option value="issues" <!-- TMPL_IF NAME="overduetype_issues" -->selected="selected"<!-- /TMPL_IF -->>Checked out items</option>
						<option value="stackrequests" <!-- TMPL_IF NAME="overduetype_stackrequests" -->selected="selected"<!-- /TMPL_IF -->>Stack requests</option>
					</select>
				</li>
				
				<li>
					<label>Level:</label>
					<select name="level" id="level">
						<option value="first" <!-- TMPL_IF NAME="level_first" -->selected="selected"<!-- /TMPL_IF -->>First</option>
						<option value="second" <!-- TMPL_IF NAME="level_second" -->selected="selected"<!-- /TMPL_IF -->>Second</option>
						<option value="third" <!-- TMPL_IF NAME="level_third" -->selected="selected"<!-- /TMPL_IF -->>Third</option>
					</select>
				</li>
				
				<li>
					<label>Library of the patron:</label>
					<select name="branch" id="branch">
						<option value="">Any</option>
						<!-- TMPL_LOOP name="branchloop" -->
							<!-- TMPL_IF NAME="selected" -->
								<option value="<!-- TMPL_VAR name="value" escape="html" -->" selected="selected"><!-- TMPL_VAR name="branchname" --></option>
							<!-- TMPL_ELSE -->
								<option value="<!-- TMPL_VAR name="value" escape="html" -->"><!-- TMPL_VAR name="branchname" --></option>
							<!-- /TMPL_IF -->
						<!-- /TMPL_LOOP -->
					</select>
				</li>
				
			    <li>
			    	<label>Patron category:</label>
			    	<select name="borcat" id="borcat">
			    		<option value="">Any</option>
						<!-- TMPL_LOOP name="borcatloop" -->
							<!-- TMPL_IF NAME="selected" --><option value="<!-- TMPL_VAR name="value" escape="html" -->" selected="selected"><!-- TMPL_VAR name="catname" --></option><!-- TMPL_ELSE --><option value="<!-- TMPL_VAR name="value" escape="html" -->"><!-- TMPL_VAR name="catname" --></option><!-- /TMPL_IF -->
						<!-- /TMPL_LOOP -->
					</select>
				</li>
			
			
			    <li>
			    	<label for="order">Sort By:</label>
			    	<select name="order" id="order">
						<!-- TMPL_LOOP NAME="ORDER_LOOP" -->
						    <option value="<!-- TMPL_VAR NAME="ordervalue" DEFAULT="" -->" <!-- TMPL_IF NAME="selected" -->selected="selected"<!-- /TMPL_IF -->>
							    <!-- TMPL_IF    NAME="order_date_due"      -->Due Date
							    <!-- TMPL_ELSIF NAME="order_borrower"      -->Patron
							    <!-- TMPL_ELSIF NAME="order_barcode"       -->Barcode
							    <!-- TMPL_ELSIF NAME="order_title"         -->Title
							    <!-- /TMPL_IF -->
						    </option>
						<!-- /TMPL_LOOP -->
					</select>
					<select name="order_direction" id="order_direction">
						<option value="ASC" <!-- TMPL_IF NAME="orderdirection_ASC" -->selected="selected"<!-- /TMPL_IF -->>Ascending</option>
						<option value="DESC" <!-- TMPL_IF NAME="orderdirection_DESC" -->selected="selected"<!-- /TMPL_IF -->>Descending</option>
					</select>
				</li>
			</ol>
	
			<fieldset class="action">
				<button name="op" value="apply_filter" class="submit">Apply Filter</button>
			</fieldset>
		</fieldset>
	</form>
</div>
</div>

<!-- TMPL_INCLUDE NAME="intranet-bottom.inc" -->
